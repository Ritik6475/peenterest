<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/stylesheets/show.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        /* Define CSS animation for fade-out effect */
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .card.fade-out {
            animation: fadeOut 0.5s ease forwards;
        }
    </style>

</head>
<body>

<nav>
    <a href="#" class="logo"><i class="fab fa-pinterest"></i>Pinterest</a>
    <div class="nav-links">
        <a href="/profile">Profile</a>
        <a href="/feed">Feed</a>
        <a href="/logout" class="logout">Logout</a>
    </div>
</nav>

<div class="cards">
    <% user.posts.forEach(function(post){ %>
        <div class="card" data-post-id="<%= post._id %>">
            <div style="overflow: hidden;">
                <img src="/images/uploads/<%= post.image %>" alt="">
            </div>
            <h5 class="deletepost"> <!-- Changed id to class here -->
                <i class="fa-solid fa-trash" style="margin-inline-start: 50%; margin-top: 10px; cursor: pointer;"></i>
            </h5>
            <h5><b></b></h5>
            <h5 style="margin-bottom: 3px; "><b></b></h5>
        </div>
    <% }) %>
</div>

<div class="confirmation-box" id="confirmationBox">
    <p>Are you sure you want to delete this post?
    </p>
    <button id="confirmYesButton">Delete</button>
    <button id="confirmNoButton">Cancel</button>
</div>












<script>
    document.addEventListener('DOMContentLoaded', function() {
        const confirmationBox = document.getElementById('confirmationBox');
        const confirmYesButton = document.getElementById('confirmYesButton');
        const confirmNoButton = document.getElementById('confirmNoButton');
        const deletePosts = document.querySelectorAll('.deletepost');

        let postIdToDelete; // Variable to store the ID of the post to delete

        function showConfirmationBox() {
            confirmationBox.style.display = 'block';
        }

        function hideConfirmationBox() {
            confirmationBox.style.display = 'none';
        }

        // Loop through all delete posts and add event listener to each
        deletePosts.forEach(deletePost => {
            deletePost.addEventListener('click', function() {
                postIdToDelete = deletePost.parentElement.dataset.postId; // Access the post ID from the parent element
                showConfirmationBox();
            });
        });

        // Event listener for "Yes" button in the confirmation box
        confirmYesButton.addEventListener('click', function() {
            // Send AJAX request to delete the post
            fetch(`/deletepost/${postIdToDelete}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (response.ok) {
                    // If post is successfully deleted, apply fade-out animation and remove from the UI
                    const deletedPostCard = document.querySelector(`.card[data-post-id="${postIdToDelete}"]`);
                    deletedPostCard.classList.add('fade-out');
                    setTimeout(() => {
                        deletedPostCard.remove();
                    }, 500); // Wait for animation to complete before removing the element
                }
            })
            .catch(error => {
                console.error('Error deleting post:', error);
            });

            hideConfirmationBox();
        });

        // Event listener for "No" button in the confirmation box
        confirmNoButton.addEventListener('click', function() {
            hideConfirmationBox();
        });
    });
</script>

</body>
</html>
